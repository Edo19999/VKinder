# üß© MockDatabaseRepository

## ‚ú® –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
`MockDatabaseRepository` ‚Äî —ç—Ç–æ –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ **–≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏**.  
–û–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î.

---

## üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `add_or_update_user(user: VKUser)` ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
- `get_user_by_vk_id(vk_id: int)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –µ–≥–æ ID.  
- `add_found_user(user_data: dict)` ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
- `get_found_user(vk_id: int)` ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### üñº –§–æ—Ç–æ
- `add_user_photos(vk_id: int, photos: List[UserPhoto])` ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.  
- `get_user_photos(vk_id: int)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### ‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
- `add_to_favorites(user_vk_id: int, target_vk_id: int)` ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ.  
- `remove_from_favorites(user_vk_id: int, target_vk_id: int)` ‚Äî —É–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ.  
- `get_user_favorites(user_vk_id: int)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ ID –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö.  
- `get_favorites(user_vk_id: int)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Å –∏–º–µ–Ω–µ–º –∏ —Å—Å—ã–ª–∫–æ–π.  
- `is_in_favorites(user_vk_id: int, target_vk_id: int)` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º.

### üîÑ –°–æ—Å—Ç–æ—è–Ω–∏—è (FSM)
- `set_user_state(vk_id: int, state: UserState)` ‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
- `get_user_state(vk_id: int)` ‚Äî –ø–æ–ª—É—á–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
- `update_user_state(user_id: int, state: str, state_data: Optional[dict])` ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.  
- `delete_user_state(vk_id: int)` ‚Äî —É–¥–∞–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### üîç –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞
- `add_search_history(user_vk_id: int, target_vk_id: int, action: str)` ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∏—Å–∫–∞.  
- `get_search_history(user_vk_id: int, limit: int = 50)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### üëÄ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏
- `add_to_viewed(user_id: int, viewed_vk_id: int)` ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
- `get_viewed_users(user_id: int)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π.

### üëç –û—Ü–µ–Ω–∫–∏
- `add_user_rating(user_id: int, rated_vk_id: int, rating_type: str)` ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ü–µ–Ω–∫—É (–ª–∞–π–∫/–¥–∏–∑–ª–∞–π–∫/–±–∞–Ω).  
- `get_user_rating(user_id: int, rated_vk_id: int)` ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –æ—Ü–µ–Ω–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## üõ† –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `cursor()` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≥–ª—É—à–∫—É `MockCursor`.  
- `close()` ‚Äî –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–ª–æ–≥–∏—á–µ—Å–∫–∏).  
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (`with ... as ...`).

`MockCursor` —ç–º—É–ª–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å –∫—É—Ä—Å–æ—Ä–æ–º PostgreSQL:
- `execute(query, params=None)` ‚Äî –∏–º–∏—Ç–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞.  
- `fetchone()` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É.  
- `fetchall()` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ —Å—Ç—Ä–æ–∫–∏.

---

## ‚úÖ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
from database.mock_repository import MockDatabaseRepository
from database.models import VKUser

db = MockDatabaseRepository()

# –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user = VKUser(vk_id=1, first_name="Ivan", last_name="Petrov")
db.add_or_update_user(user)

# –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
u = db.get_user_by_vk_id(1)
print(u.first_name)  # Ivan

# –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
db.add_to_favorites(1, 2)

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
print(db.get_user_favorites(1))  # [2]
```

---
